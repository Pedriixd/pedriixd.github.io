<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>STICKEAME - Editor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.1/fabric.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Comic+Neue:wght@400;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .modal { transition: opacity 0.3s ease-in-out; }
        .modal-active { opacity: 1; pointer-events: auto; }
        .modal-inactive { opacity: 0; pointer-events: none; }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="bg-slate-100 text-gray-900 flex flex-col h-screen">

    <aside id="gallery-panel" class="w-full md:w-72 lg:w-96 bg-white shadow-lg p-4 flex-col gap-4 absolute md:relative z-10 md:z-0 h-full md:flex -translate-x-full md:translate-x-0 transition-transform duration-300">
         <div class="flex justify-between items-center mb-2">
            <h2 class="text-xl font-bold">Galería de Stickers</h2>
            <button id="close-gallery-btn" class="md:hidden p-2 rounded-full hover:bg-gray-200">
                <i class="fa-solid fa-xmark"></i>
            </button>
        </div>
        <div class="flex flex-col gap-3 mb-3">
            <input id="search-input" type="text" placeholder="Buscar por nombre..." class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-emerald-400">
            <div id="category-filters" class="flex flex-wrap gap-2"></div>
            <label class="flex items-center gap-2 cursor-pointer"><input id="favorites-toggle" type="checkbox" class="h-5 w-5 text-emerald-500 rounded"/> <span>Mostrar solo favoritos</span></label>
        </div>
        <div id="stickers-container" class="flex-1 overflow-y-auto grid grid-cols-2 sm:grid-cols-3 md:grid-cols-2 lg:grid-cols-3 gap-3 pr-2 scrollbar-hide">
            </div>
    </aside>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- CONSTANTES Y CONFIGURACIÓN ---
            const JSON_ENDPOINT = "https://script.google.com/macros/s/AKfycbxwS_B_g5YpCcQ5gytZprlzLCk70ZTcUK7_dTeDv37pL9wHq3wIT7E0t-Zulnf__grw/exec";
            
            // ==================================================================
            // NUEVO: Define aquí los enlaces de tus carpetas de Google Drive
            // La "clave" (ej. "Animes") debe coincidir EXACTAMENTE con el nombre de la categoría en tu JSON.
            // ==================================================================
            const CATEGORY_DRIVE_LINKS = {
                "Animes": "https://drive.google.com/drive/folders/URL_DE_LA_CARPETA_ANIMES",
                "Juegos": "https://drive.google.com/drive/folders/URL_DE_LA_CARPETA_JUEGOS",
                "Memes": "https://drive.google.com/drive/folders/URL_DE_LA_CARPETA_MEMES",
                "default": "https://drive.google.com/drive/folders/URL_GENERAL_SI_NO_HAY_COINCIDENCIA"
                // Agrega más categorías y sus enlaces aquí
            };
            // ==================================================================

            const A4_ASPECT_RATIO = 210 / 297;
            const A4_WIDTH_MM = 210;
            const A4_HEIGHT_MM = 297;
            const DPI = 300;
            const EXPORT_WIDTH_PX = Math.round((A4_WIDTH_MM * DPI) / 25.4);
            const EXPORT_HEIGHT_PX = Math.round((A4_HEIGHT_MM * DPI) / 25.4);

            let canvas, pages = [], currentPageIndex = 0, allStickers = [], favorites = {};
            const stickersContainer = document.getElementById('stickers-container');
            const searchInput = document.getElementById('search-input');
            const categoryFiltersContainer = document.getElementById('category-filters');
            const favoritesToggle = document.getElementById('favorites-toggle');
            
            const init = () => {
                //... (código sin cambios)
            };

            const renderGallery = () => {
                // La lógica de filtrado de stickers no cambia
                const searchTerm = searchInput.value.toLowerCase();
                const showFavorites = favoritesToggle.checked;
                const filtered = allStickers.filter(s => {
                    const matchesSearch = s.nombre.toLowerCase().includes(searchTerm);
                    const matchesFavorites = !showFavorites || favorites[s.url];
                    return matchesSearch && matchesFavorites;
                });
                
                stickersContainer.innerHTML = '';
                if (filtered.length === 0) {
                    stickersContainer.innerHTML = '<p class="col-span-full text-center">No se encontraron stickers.</p>';
                } else {
                    filtered.forEach(sticker => {
                       // ... (código para renderizar las tarjetas de stickers no cambia)
                    });
                }
                
                // --- MODIFICADO: Lógica para renderizar los botones de categoría ---
                if (categoryFiltersContainer.children.length === 0 && allStickers.length > 0) {
                    const categories = ['Todos', ...new Set(allStickers.map(s => s.categoria))];
                    
                    categories.forEach(cat => {
                        // Ahora creamos una etiqueta <a> en lugar de <button>
                        const link = document.createElement('a');
                        link.className = `category-link px-3 py-2 text-sm rounded-full bg-emerald-500 text-white font-semibold shadow hover:bg-emerald-600 transition-all text-center`;
                        link.textContent = cat;
                        
                        // Hacemos que se abra en una nueva pestaña
                        link.target = "_blank";
                        link.rel = "noopener noreferrer";

                        if (cat === 'Todos') {
                            // El botón "Todos" apunta al enlace por defecto
                            link.href = CATEGORY_DRIVE_LINKS['default'];
                        } else {
                            // Buscamos el enlace correspondiente en nuestro objeto de configuración
                            link.href = CATEGORY_DRIVE_LINKS[cat] || CATEGORY_DRIVE_LINKS['default'];
                        }
                        
                        categoryFiltersContainer.appendChild(link);
                    });
                }
            };
            
            // El resto del script (lógica del canvas, exportación, etc.) permanece igual.
            // ...

            // --- INICIALIZACIÓN ---
            // init(); // Esta función se llamaría para empezar todo
        });
    </script>
</body>
</html>
